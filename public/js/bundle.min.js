"use strict";angular.module("app.auth",[]).service("Session",[function(){this.token=null,this.user=null,this._createLc=function(e,t){window.localStorage.setItem("token",angular.toJson(e)),window.localStorage.setItem("user",angular.toJson(t))},this._destroyLc=function(){window.localStorage.removeItem("token"),window.localStorage.removeItem("user")},this.create=function(e,t){this.token=e,this.user=t,this._createLc(e,t)},this.destroy=function(){this.token=null,this.user=null,this._destroyLc()},this.getToken=function(){var e=this.token;return e||(e=angular.fromJson(window.localStorage.getItem("token"))),e},this.getUser=function(){var e=this.user;return e||(e=angular.fromJson(window.localStorage.getItem("user"))),e},this.isAuthenticated=function(){return null!=this.getToken()}}]),angular.module("app.auth").factory("AuthInterceptor",["$rootScope","$q","AUTH_EVENTS","Session",function(e,t,o,n){return{request:function(e){var t=n.getToken();return t&&(e.headers.Authorization="Bearer"+t),e},responseError:function(n){return console.log("entro por interceptor de error"),e.$broadcast({401:o.notAuthenticated,403:o.notAuthorized}[n.status],n),t.reject(n)}}}]),angular.module("app.auth").service("LoginService",["$http","CONFIG","Session",function(e,t,o){var n=t.API_URL+"api-token-auth/";this.handleError=function(e){console.warn(e)},this.requestToken=function(t,o,r){return e.post(n,t).then(o,r)},this.login=function(n,r){var u={method:"GET",url:t.API_URL+"users/me/",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8",Authorization:"Bearer "+n}};return e(u).then(function(e){o.create(n,e.data),r(e)},this.handleError)}}]),angular.module("app.auth").controller("LoginCtrl",["$scope","LoginService","$location",function(e,t,o){e.user={},e.busy=!1;var n=function(n){t.login(n.data.token,function(t){console.log(t),e.setCurrentUser(t.data),e.busy=!1,o.path("/")})},r=function(t){e.busy=!1,e.errors=t.data.non_field_errors,console.log(t)};e.login=function(){console.log(e.user),e.busy=!0,t.requestToken(e.user,n,r)}}]),angular.module("app.users",[]).service("UsersService",["$http","CONFIG",function(e,t){this.url=t.API_URL+"users/",this.currentUser=null,this.getAll=function(t){return e.get(this.url).then(t)},this.getUser=function(t,o){return e.get(this.url+t+"/").then(o)},this.setCurrentUser=function(e){this.currentUser=e},this.getCurrentUser=function(){return this.currentUser}}]),angular.module("app.users").controller("UsersCtrl",["$scope","UsersService","$location",function(e,t,o){e.users=[],t.getAll(function(t){e.users=t.data.results}),e.userDetail=function(e){t.setCurrentUser(e),o.path("/usuarios/"+e.id)}}]),angular.module("app.users").controller("UserDetailCtrl",["$scope","UsersService","$routeParams",function(e,t,o){e.user=t.getCurrentUser(),e.user||t.getUser(o.id,function(t){e.user=t.data})}]),angular.module("app.users").controller("ProfileCtrl",["$scope","UsersService",function(e,t){console.info("profile Ctrl works")}]),angular.module("app.home",[]).service("HomeService",["$http","CONFIG",function(e,t){var o=t.API_URL+"home/";this.handleError=function(e){console.warn(e)},this.get=function(t,n,r){return e.get(o).then(t,n)}}]),angular.module("app.home").controller("MainCtrl",["$scope","$rootScope","AUTH_EVENTS","Session",function(e,t,o,n){console.warn("main ctrl"),e.user=null,e.expandedMenu=!0,e.setCurrentUser=function(t){e.user=t},e.logout=function(e){t.$broadcast(o.logout)},e.toogleMenu=function(){e.expandedMenu=!e.expandedMenu,e.expandedMenu?$.AdminLTE.pushMenu.expand():$.AdminLTE.pushMenu.collapse()},e.setCurrentUser(n.getUser())}]),angular.module("app.home").controller("HomeCtrl",["$scope","HomeService",function(e,t){console.info("home Ctrl works")}]),angular.module("app",["ngRoute","templates","angular-loading-bar","xeditable","app.auth","app.home","app.users"]),angular.module("app").run(["$rootScope","AUTH_EVENTS","Session","$location","editableOptions","editableThemes",function(e,t,o,n,r,u){function s(){o.destroy(),n.path("/login")}r.theme="bs3",u.bs3.submitTpl='<button class="btn btn-flat btn-primary" type="submit"><i class="fa fa-check"></i></button>',u.bs3.cancelTpl='<button class="btn btn-flat btn-default" ng-click="$form.$cancel()"><i class="fa fa-times"></i></button>',e.$on(t.notAuthenticated,function(){s(),console.info("se activo interceptor not authenticated")}),e.$on(t.notAuthorized,function(){s(),console.info("se activo interceptor not authorized")}),e.$on(t.logout,function(){s(),console.info("se cerrara la sesion")}),e.$on("$routeChangeStart",function(e,t){"/login"!==n.path()&&(o.isAuthenticated()||s())}),e.goTo=function(e){n.path(e)}}]),angular.module("app").config(["$routeProvider","$locationProvider",function(e,t){e.when("/login",{controller:"LoginCtrl",templateUrl:"app/auth/login.html"}).when("/",{controller:"HomeCtrl",templateUrl:"app/home/home.html"}).when("/usuarios",{controller:"UsersCtrl",templateUrl:"app/users/users.html"}).when("/usuarios/:id",{controller:"UserDetailCtrl",templateUrl:"app/users/users-detail.html"}).when("/perfil",{controller:"ProfileCtrl",templateUrl:"app/users/profile.html"}).otherwise({redirectTo:"/"}),t.html5Mode(!0)}]),angular.module("app").constant("CONFIG",{ROOT_UR:"http://localhost:8080/",API_URL:"http://localhost:8000/api/v1/"}).constant("AUTH_EVENTS",{notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized",logout:"auth-logout"}),angular.module("app").config(["$httpProvider",function(e){e.interceptors.push(["$injector",function(e){return e.get("AuthInterceptor")}])}]);
//# sourceMappingURL=../maps/bundle.min.js.map
